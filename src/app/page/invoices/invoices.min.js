function callInvoicePDF(a){$("#invoicePDFForm #invoiceId").val(a),$("#invoicePDFForm").submit()}function callInvoicePDFLink(a){$("#invoicePDFForm #invoiceId").val(a),$("#invoicePDFForm #invoicePrint").val("false"),$("#invoicePDFForm").submit()}function goToOrderDetails(a){$("#orderDetailsForm #orderId").val(a),$("#orderDetailsForm #hybrisOrder").val(!1),$("#orderDetailsForm").submit()}function goToEftDetails(a,b){$("#eftForm #eftId").val(a),$("#eftForm #fiscalYear").val(b),$("#eftForm").submit()}function payInvoice(){if(!disablePayError||enableInvoiceError||enableTotalError){$(".alert-danger").addClass("hide"),disablePayError||$(".js-selected-product-error").removeClass("hide"),enableInvoiceError&&$(".js-selected-invoice-error").removeClass("hide"),enableTotalError&&$(".js-total-amount-error").removeClass("hide");var a=[];$("#table tbody").find("tr.selected input[name='type']").each(function(){a=$(this).val().split("@"),(productCodes.indexOf(a[0])==-1||invoiceStatusCodes.indexOf(a[1])>-1)&&$(this).parents("tr").addClass("bg-danger")})}else $.isEmptyObject(invoiceObj)&&(invoiceObj.shipTo=$("#shipToSelectDdn").val(),invoiceObj.soldTo=$("#locationSelectDdn").val(),invoiceObj.invoiceNumber=$("#invoiceNumber").val(),invoiceObj.salesOrderNumber=$("#orderNumber").val(),invoiceObj.poNumber=$("#poNumber").val(),invoiceObj.invoiceTypes=$("#invoiceTypeDdn").val(),invoiceObj.downloadStatus=$("#downloadStatus").val(),invoiceObj.printStatus=$("#printStatus").val(),invoiceObj.paymentStatus=$("#paymentStatusDdn").val(),invoiceObj.startDate=startDate,invoiceObj.endDate=endDate),localStorage.setItem("invoiceObj",JSON.stringify(invoiceObj)),$(".js-selected-product-error").addClass("hide"),$("#paymentForm #selectedInvoices").val(selectedInvoices.toString()),$("#paymentForm").submit()}function callInvoicePDF(a){$("#invoicePDFForm #invoiceId").val(a),$("#invoicePDFForm").submit()}function callInvoicePDFLink(a){$("#invoicePDFForm #invoiceId").val(a),$("#invoicePDFForm #invoicePrint").val("false"),$("#invoicePDFForm").submit()}function goToOrderDetails(a){$("#orderDetailsForm #orderId").val(a),$("#orderDetailsForm #hybrisOrder").val(!1),$("#orderDetailsForm").submit()}function goToEftDetails(a,b){$("#eftForm #eftId").val(a),$("#eftForm #fiscalYear").val(b),$("#eftForm").submit()}function payInvoice(){if(!disablePayError||enableInvoiceError||enableTotalError){$(".alert-danger").addClass("hide"),disablePayError||$(".js-selected-product-error").removeClass("hide"),enableInvoiceError&&$(".js-selected-invoice-error").removeClass("hide"),enableTotalError&&$(".js-total-amount-error").removeClass("hide");var a=[];$("#table tbody").find("tr.selected input[name='type']").each(function(){a=$(this).val().split("@"),(-1==productCodes.indexOf(a[0])||invoiceStatusCodes.indexOf(a[1])>-1)&&$(this).parents("tr").addClass("bg-danger")})}else $.isEmptyObject(invoiceObj)&&(invoiceObj.shipTo=$("#shipToSelectDdn").val(),invoiceObj.soldTo=$("#locationSelectDdn").val(),invoiceObj.invoiceNumber=$("#invoiceNumber").val(),invoiceObj.salesOrderNumber=$("#orderNumber").val(),invoiceObj.poNumber=$("#poNumber").val(),invoiceObj.invoiceTypes=$("#invoiceTypeDdn").val(),invoiceObj.downloadStatus=$("#downloadStatus").val(),invoiceObj.printStatus=$("#printStatus").val(),invoiceObj.paymentStatus=$("#paymentStatusDdn").val(),invoiceObj.startDate=startDate,invoiceObj.endDate=endDate),localStorage.setItem("invoiceObj",JSON.stringify(invoiceObj)),$(".js-selected-product-error").addClass("hide"),$("#paymentForm #selectedInvoices").val(selectedInvoices.toString()),$("#paymentForm").submit()}var locationDropDownOptions=[],startDate,endDate,pastSelectableDate=6,invoiceObj={},invoiceTotalSum=0;if(locationDropDownOptions=locationDropDown.map(function(a,b){return{key:a.soldToNumber,value:a.soldToAddress}}),locationDropDownOptions.length>1&&locationDropDownOptions.unshift({key:"all",value:"All"}),cbp.invoicesPage.locationDropDown.options=locationDropDownOptions,cbp.invoicesPage.locationDropDown.searchable=!0,paymentStatusDropdownOptions.length>1){var obj={};obj.key="all",obj.value=cbp.invoicesPage.paymentStatusDropdown.title,paymentStatusDropdownOptions.unshift(obj)}cbp.invoicesPage.paymentStatusDropdown.options=paymentStatusDropdownOptions;var selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],disablePayError=!1,enableInvoiceError=!1,enableTotalError=!1;require(["modernizr","jquery","bootstrap","handlebars","moment","calendar","bootstrap-select","bootstrap-table","text!app/components/calendar/_calendar.hbs","text!app/components/dropdown/_defaultDdn.hbs","text!app/page/invoices/searchForm.hbs","text!app/page/invoices/invoicesSummary.hbs","text!app/page/invoices/bottomDetail.hbs"],function(a,b,c,d,e,f,g,h,j,k,l,m,n){var o=d.compile(k),p=d.compile(j),q=d.compile(l),r=d.compile(m),s=d.compile(n),t=function(){function a(){var a=invoicesResponse.summaryResponse;if(a.length>5){a=a.split(",");var b=a[0],c=a.splice(1);invoicesResponse.soldShipToBlock=b+",",invoicesResponse.soldShipToNormal=c}else invoicesResponse.soldShipToBlock=a,invoicesResponse.soldShipToNormal=""}var c={locationDdnContainer:".js-location-ddn",shipToDdnContainer:".js-shipTo-ddn",invoicesSummaryContainer:".js-invoices-summary",invoicesTypeContainer:".js-invoicesType-ddn",paymentStatusContainer:".js-paymentStatus-ddn",downloadStatusContainer:".js-downloadStatus-ddn",printStatusContainer:".js-printStatus-ddn",pickDateRangeContainer:".js-search-pickDateRange",searchFormContainer:".js-search-form",searchDetailContainer:".js-bottom-detail",sortByDdnContainer:".js-sortbyDdn",dropDownCommon:".selectpicker",ordercalendar:"#calendar",searchButton:"#invoicesSearch",tabelRow:"#table tbody tr",downloadBtn:".js-downloadBtn",printBtn:".js-printBtn",payInvBtn:".js-payInvBtn",invoiceTypeDdn:"#invoiceTypeDdn",paymentStatusDdn:"#paymentStatusDdn",locationDdn:"#locationSelectDdn",shipToDdn:"#shipToSelectDdn",downloadStatusDdn:"#downloadStatus",printStatusDdn:"#printStatus",sortByDdn:"#sortByDdn",displaySpinner:".overlay-wrapper",dropdownSelect:".dropdown-menu .toggle-select",invoiceNumber:"#invoiceNumber",orderNumber:"#orderNumber",poNumber:"#poNumber",squareUnchecked:"fa-square-o",squareChecked:"fa-check-square-o",downloadIcon:".iconsPrintDownload",printIcon:".iconsInvoicePrint"},d=function(){if(h(),1==cbp.invoicesPage.locationDropDown.options.length?(A(b(c.locationDdn).val(),"all"),b(c.searchButton).removeAttr("disabled")):cbp.invoicesPage.locationDropDown.options.length>1,b(c.locationDdn).selectpicker("refresh"),z(shipToListOnLoad),"true"===allInvoiceFlow&&(b(c.downloadStatusDdn).val("notDownloaded").selectpicker("refresh"),b(c.printStatusDdn).val("notPrinted").selectpicker("refresh")),void 0!==localStorage.getItem("invoiceObj")&&null!==localStorage.getItem("invoiceObj")&&isPaymentFlow){var a=JSON.parse(localStorage.getItem("invoiceObj"));startDate=a.startDate,endDate=a.endDate,cbp.invoicesPage.dateRange.startDate=e(startDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.dateRange.endDate=e(endDate,cbp.invoicesPage.dateRange.format,!0),b(c.invoiceNumber).val(a.invoiceNumber),b(c.orderNumber).val(a.salesOrderNumber),b(c.poNumber).val(a.poNumber),b(c.invoiceTypeDdn).val(a.invoiceTypes).selectpicker("refresh"),b(c.paymentStatusDdn).val(a.paymentStatus).selectpicker("refresh"),b(c.downloadStatusDdn).val(a.downloadStatus).selectpicker("refresh"),b(c.printStatusDdn).val(a.printStatus).selectpicker("refresh"),b(c.locationDdn).val(a.soldTo).selectpicker("refresh"),b.when(A(a.soldTo,a.shipTo)).then(function(a){m()}),localStorage.removeItem("invoiceObj"),b(c.searchButton).removeAttr("disabled")}else D(cbp.invoicesPage.invoicesResponse.invoicesDataList,cbp.invoicesPage.invoicesResponse.invoicesSearchList);l(),B(),"true"===noCardsAdded&&"true"===ccPaymentEligible?b(".js-card-error").removeClass("hide"):"true"===allCardsExpired&&"true"===ccPaymentEligible&&b(".js-card-expired-error").removeClass("hide")},f=function(){b("#invoiceForm #selectedInvoices").val(selectedInvoices.toString());for(var a=0;len=selectedInvoices.length,a<len;a++)b(".iconsPrintDownload[data-invoiceid='"+selectedInvoices[a]+"']").addClass("success-icon"),cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+selectedInvoices[a]+"']").data("index")].downloaded=!0;b("#invoiceForm").submit(),selectedInvoices.length=0},g=function(){var a=selectedInvoices.length;b("#invoiceForm #selectedInvoices").val(selectedInvoices.toString());var c=b("#contextPath").val()+"/invoices/invoiceListPDF",d=b("#invoiceForm").attr("action");b("#invoiceForm").attr("action",c),b("#invoiceForm").attr("target","_blank");for(var e=0;e<a;e++)b(".iconsInvoicePrint[data-invoiceid='"+selectedInvoices[e]+"']").addClass("success-icon"),cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+selectedInvoices[e]+"']").data("index")].printed=!0;b("#invoiceForm").submit(),b("#invoiceForm").attr("action",d),b("#invoiceForm").removeAttr("target"),selectedInvoices.length=0},h=function(){b(c.searchFormContainer).html(q(cbp.invoicesPage)),b(c.locationDdnContainer).html(o(cbp.invoicesPage.locationDropDown)),b(c.shipToDdnContainer).html(o(cbp.invoicesPage.shipToDropDown)),b(c.downloadStatusContainer).html(o(cbp.invoicesPage.downloadStatusDropdown)),b(c.invoicesTypeContainer).html(o(cbp.invoicesPage.invoiceTypeDropdown)),b(c.paymentStatusContainer).html(o(cbp.invoicesPage.paymentStatusDropdown)),b(c.printStatusContainer).html(o(cbp.invoicesPage.printStatusDropdown)),b(c.pickDateRangeContainer).html(p({label:cbp.invoicesPage.globalVars.pickDateRange,iconClass:cbp.invoicesPage.dateRange.iconClass,id:cbp.invoicesPage.dateRange.id})),console.log("option select all in ship to",shipToListOnLoad.length),shipToListOnLoad.length<2?(cbp.invoicesPage.showSoldTo=!1,invoicesResponse.summaryResponse=invoicesResponse.summary.shipTo):(cbp.invoicesPage.showSoldTo=!0,invoicesResponse.summaryResponse=invoicesResponse.summary.soldTo),j(),b(c.dropDownCommon).selectpicker("refresh"),k(),b(c.displaySpinner).hide()},j=function(){a(),b(c.invoicesSummaryContainer).html(r(cbp.invoicesPage)),b(c.searchDetailContainer).html(s(cbp.invoicesPage)),b(c.sortByDdnContainer).html(o(y)),b(c.sortByDdnContainer).find(c.dropDownCommon).selectpicker("refresh"),k()},k=function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&b(c.dropDownCommon).selectpicker("mobile")},l=function(){function a(a,d){startDate=a.format(cbp.invoicesPage.dateRange.format),endDate=d.format(cbp.invoicesPage.dateRange.format),b(c.ordercalendar).find("span").html(cbp.invoicesPage.globalVars.fromAndTo.replace("{0}",startDate).replace("{1}",endDate))}"true"===allInvoiceFlow&&(cbp.invoicesPage.dateRange.startDate=e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month")),a(cbp.invoicesPage.dateRange.startDate,cbp.invoicesPage.dateRange.endDate);var d={};d[cbp.invoicesPage.dateRange.today]=[e(),e()],d[cbp.invoicesPage.dateRange.yesterday]=[e().subtract(1,"days"),e().subtract(1,"days")],d[cbp.invoicesPage.dateRange.last7Days]=[e().subtract(6,"days"),e()],d[cbp.invoicesPage.dateRange.last30Days]=[e().subtract(29,"days"),e()],d[cbp.invoicesPage.dateRange.thisMonth]=[e().startOf("month"),e().endOf("month")],d[cbp.invoicesPage.dateRange.lastMonth]=[e().subtract(1,"month").startOf("month"),e().subtract(1,"month").endOf("month")],b(c.ordercalendar).daterangepicker({startDate:cbp.invoicesPage.dateRange.startDate,endDate:cbp.invoicesPage.dateRange.endDate,ranges:d,minDate:e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month"),maxDate:e(),applyClass:"btn-primary",locale:{format:cbp.invoicesPage.dateRange.format,separator:" - ",applyLabel:cbp.invoicesPage.dateRange.apply,cancelLabel:cbp.invoicesPage.dateRange.cancel,weekLabel:"W",customRangeLabel:cbp.invoicesPage.dateRange.customRange,daysOfWeek:e.weekdaysShort(),monthNames:e.monthsShort(),firstDay:e.localeData().firstDayOfWeek()}},a)},m=function(){function a(a){b(c.displaySpinner).hide(),b(c.searchDetailContainer).show(),b(c.invoicesSummaryContainer).show(),cbp.invoicesPage.invoicesResponse=a,cbp.invoicesPage.invoicesResponse.resultCount>0?cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount):cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",0),cbp.invoicesPage.dateRange.startDate=e(startDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.dateRange.endDate=e(endDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.globalVars.summaryfromAndToVar=cbp.invoicesPage.globalVars.summaryfromAndTo.replace("{0}",cbp.invoicesPage.dateRange.startDate.format(cbp.invoicesPage.dateRange.format)).replace("{1}",cbp.invoicesPage.dateRange.endDate.format(cbp.invoicesPage.dateRange.format)),"true"===allInvoiceFlow||cbp.invoicesPage.invoicesResponse.resultCount>0&&cbp.invoicesPage.invoicesResponse.resultCount<maxResults?cbp.invoicesPage.showDebitCredit=!0:cbp.invoicesPage.showDebitCredit=!1,j(),D(cbp.invoicesPage.invoicesResponse.invoicesDataList,cbp.invoicesPage.invoicesResponse.invoicesSearchList),leftPaneExpandCollapse.resetSearchFormHeight()}function d(){b(c.displaySpinner).hide(),b(c.searchDetailContainer).show(),b(c.invoicesSummaryContainer).show(),console.log("error")}b(c.displaySpinner).show(),b(c.invoicesSummaryContainer).hide(),b(c.searchDetailContainer).hide(),leftPaneExpandCollapse.hideSearchBar();var f=[];b(c.invoiceTypeDdn).find("option").each(function(){f.push(b(this).val())});var g={};if(g.shipTo=b(c.shipToDdn).val(),g.soldTo=b(c.locationDdn).val(),""!=b(c.invoiceNumber).val()&&(g.invoiceNumber=parseInt(b(c.invoiceNumber).val().trim(),10),b(c.invoiceNumber).val(g.invoiceNumber)),""!=b(c.orderNumber).val()&&(g.salesOrderNumber=b(c.orderNumber).val().trim(),b(c.orderNumber).val(g.salesOrderNumber)),""!=b(c.poNumber).val()&&(g.poNumber=b(c.poNumber).val().trim(),b(c.poNumber).val(g.poNumber)),g.invoiceTypes=[b(c.invoiceTypeDdn).val()?""+b(c.invoiceTypeDdn).val():f.toString()],g.downloadedStatus=b(c.downloadStatusDdn).val(),g.paymentStatus=b(c.paymentStatusDdn).find("option:selected").text(),g.printed=b(c.printStatusDdn).val(),""!=b(c.invoiceNumber).val()||""!=b(c.orderNumber).val()||""!=b(c.poNumber).val()){var h=e().subtract(cbp.invoicesPage.dateRange.backDatedRange,"month");h=h.format(cbp.invoicesPage.dateRange.format);var i=e();i=i.format(cbp.invoicesPage.dateRange.format),g.fromDate=h,g.toDate=i}else g.fromDate=startDate,g.toDate=endDate;"all"!=b(c.shipToDdn).val()?(cbp.invoicesPage.showSoldTo=!1,invoicesResponse.summaryResponse=invoicesResponse.summary.shipTo):(cbp.invoicesPage.showSoldTo=!0,invoicesResponse.summaryResponse=invoicesResponse.summary.soldTo),b.ajax({type:"POST",data:JSON.stringify(g),contentType:"application/json",dataType:"json",url:cbp.invoicesPage.globalUrl.invoicePostURL,success:a,error:d})},n=function(){b(c.orderNumber).siblings("label").text(cbp.invoicesPage.globalVars.orderNumberNew),b(c.poNumber).siblings("label").text(cbp.invoicesPage.globalVars.poNumberNew),cbp.invoicesPage.globalVars.orderNumbertb=cbp.invoicesPage.globalVars.orderNumbertbNew,cbp.invoicesPage.globalVars.customerPOtb=cbp.invoicesPage.globalVars.customerPOtbNew},t=function(a){var c=window.location.pathname,d="<form id='downloadForm' method='POST' action='"+c+"/invoiceCSV'><input type='hidden' name='selectedInvoices' value='"+a+"'/></form>";cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+a+"']").data("index")].downloaded=!0,b(d).appendTo("body").submit().remove()},u=function(){b(c.downloadBtn).removeClass("disabled"),b(c.printBtn).removeClass("disabled"),w()},v=function(){b(c.downloadBtn).addClass("disabled"),b(c.printBtn).addClass("disabled"),w()},w=function(){var a=selectedProduct.length;a>=0&&(disablePayError=!0);for(var d=0;d<a;d++)productCodes.indexOf(selectedProduct[d])==-1&&(disablePayError=!1);a>0?b(c.payInvBtn).removeClass("disabled"):b(c.payInvBtn).addClass("disabled"),(disablePayError||0===a)&&b(".js-selected-product-error").addClass("hide")},x=function(a){if(null!=a){globalSortList=[{key:"invoiceDate-desc",value:cbp.invoicesPage.globalVars.invoiceDateAsc},{key:"invoiceDate-asc",value:cbp.invoicesPage.globalVars.invoiceDateDesc},{key:"location-asc",value:cbp.invoicesPage.globalVars.locationSortAsc},{key:"location-desc",value:cbp.invoicesPage.globalVars.locationSortDesc},{key:"orderId-asc",value:cbp.invoicesPage.globalVars.orderNumberAsc},{key:"orderId-desc",value:cbp.invoicesPage.globalVars.orderNumberDesc},{key:"invoiceId-asc",value:cbp.invoicesPage.globalVars.invoiceNumberAsc},{key:"invoiceId-desc",value:cbp.invoicesPage.globalVars.invoiceNumberDesc},{key:"type-asc",value:cbp.invoicesPage.globalVars.invoiceTypeAsc},{key:"type-desc",value:cbp.invoicesPage.globalVars.invoiceTypeDesc},{key:"total-asc",value:cbp.invoicesPage.globalVars.totalAsc},{key:"total-desc",value:cbp.invoicesPage.globalVars.totalDesc}];var b=globalSortList.reduce(function(a,b){return a[b.key]=b,a},{});console.log(b);var c=Object.keys(b).filter(function(a){if(b[a])return b[a]});console.log(c);var d=Object.keys(a).filter(function(b){if(a[b])return a[b]});console.log(d);var e=function(a){return d.indexOf(a.replace(/\-(asc|desc)/,""))!=-1},f=c.filter(function(a){return e(a)});console.log("fgsdyfgkf",f);var g=[];for(i=0;i<f.length;i++){var h=f[i];console.log(h),g.push(b[h])}return console.log("req res",g),g}},y={options:x(invoicesResponse.invoicesSearchList),label:cbp.invoicesPage.globalVars.sortBy,labelClass:"xs-mr-5",name:"sortByDdn",display:"displayInline"},z=function(a){console.log("Calling in method >>>>>");var d=[];if(1==a.length)cbp.invoicesPage.shipToDropDown.singleOption=!0,b(c.searchButton).removeAttr("disabled");else if(a.length>1){var e={};e.key="all",e.value=cbp.invoicesPage.globalVars.allTb,d.push(e)}for(var f=0;f<a.length;f++){var e={};e.key=a[f].uid,e.value=a[f].displayName,d.push(e)}cbp.invoicesPage.shipToDropDown.options=d,cbp.invoicesPage.shipToDropDown.searchable=!0,b(c.shipToDdnContainer).html(o(cbp.invoicesPage.shipToDropDown)),b(c.shipToDdn).selectpicker("refresh")},A=function(a,d){function e(a){b(c.displaySpinner).hide();var e=[],f={},g=a;console.log(g),e=g.map(function(a,b){return{key:a.uid,value:a.displayName}}),1==g.length?cbp.invoicesPage.shipToDropDown.singleOption=!0:g.length>=1&&(f.key="all",f.value=cbp.invoicesPage.globalVars.allTb,e.unshift(f)),console.log("shipToOptions >>>",e),cbp.invoicesPage.shipToDropDown.options=e,cbp.invoicesPage.shipToDropDown.searchable=!0,b(c.shipToDdnContainer).html(o(cbp.invoicesPage.shipToDropDown)),b(c.shipToDdn).selectpicker("refresh"),cbp.invoicesPage.shipToDropDown.options.length>1&&b(c.shipToDdn).val(d).selectpicker("refresh");var h=[];if(a.invoiceTypeList)for(var i=0;i<a.invoiceTypeList.length;i++){var j={};j.key=a.invoiceTypeList[i].code,j.value=a.invoiceTypeList[i].description,h.push(j)}cbp.invoicesPage.invoiceTypeDropdown.options=h,b(c.invoicesTypeContainer).html(o(cbp.invoicesPage.invoiceTypeDropdown)),b(c.invoiceTypeDdn).selectpicker("refresh")}function f(){b(c.displaySpinner).hide(),console.log("error")}return b(c.displaySpinner).show(),b.ajax({type:"POST",data:{soldToNumber:a},dataType:"json",url:cbp.invoicesPage.globalUrl.shipToURL,success:e,error:f})},B=function(){b(document).on("reset-view.bs.table, toggle.bs.table","#table",function(a){a.stopPropagation();for(var c=0;c<selectedInvoices.length;c++)b("#table tbody tr[data-uniqueid="+selectedInvoices[c]+"]").find("input[type=checkbox]").attr("checked","checked")}),b(document).on("click",c.downloadBtn,function(){f()}),b(document).on("click",c.printBtn,function(){g()}),b(c.locationDdn).on("change",function(a){""!==b(c.locationDdn).val()?b(c.searchButton).removeAttr("disabled"):b(c.searchButton).attr("disabled","disabled"),n(),A(b(c.locationDdn).val(),"all")}),b(document).on("change",c.shipToDdn,function(a){""!==b(this).val()?b(c.searchButton).removeAttr("disabled"):b(c.searchButton).attr("disabled","disabled")}),b(document).on("click",c.downloadIcon,function(a){var c=b("#isInternalUser").val();"true"!=c&&"true"!==inASMSession&&b(a.target).addClass("success-icon"),t(b(a.target).attr("data-invoiceId"))}),b(document).on("click",c.printIcon,function(a){var c=b("#isInternalUser").val();"true"!=c&&"true"!==inASMSession&&b(this).addClass("success-icon");var d=b(a.target).attr("data-invoiceId");selectedInvoices=[d],g()}),b(c.searchButton).on("click",function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],invoiceObj.shipTo=b("#shipToSelectDdn").val(),invoiceObj.soldTo=b("#locationSelectDdn").val(),invoiceObj.invoiceNumber=b("#invoiceNumber").val(),invoiceObj.salesOrderNumber=b("#orderNumber").val(),invoiceObj.poNumber=b("#poNumber").val(),invoiceObj.invoiceTypes=b("#invoiceTypeDdn").val(),invoiceObj.downloadStatus=b("#downloadStatus").val(),invoiceObj.printStatus=b("#printStatus").val(),invoiceObj.paymentStatus=b("#paymentStatusDdn").val(),invoiceObj.startDate=startDate,invoiceObj.endDate=endDate,b(".alert-danger").addClass("hide"),m()});var a=".js-search-form input,"+c.printStatusContainer+","+c.locationDdnContainer+","+c.downloadStatusContainer+","+c.pickDateRangeContainer;b(document).on("keypress",a,function(a){13==a.which&&(a.preventDefault(),b("#invoicesSearch").trigger("click"))});var d=c.invoiceNumber+","+c.orderNumber;b(document).on("keypress",d,function(a){var b=/^[0-9]+$/,c=String.fromCharCode(a.which);return!!c.match(b)||(a.preventDefault(),!1)})},C=function(a){if(null!=a){var b=Object.keys(a).filter(function(b){if(a[b])return a[b]});console.log("columns to be seen",b);var c=[{field:"checkbox",checkbox:!0,"class":"fa",formatter:function(a,b,c){return'<input type="hidden" name="type" value="'+b.type+"@"+b.cbpInvoiceStatus+'">'}},{field:"status",title:cbp.invoicesPage.globalVars.statustb,titleTooltip:cbp.invoicesPage.globalVars.statustb,"class":"text-nowrap",formatter:function(a,b,c){var d,e,f="",g="";return b.downloaded&&"true"!==inASMSession&&(f="success-icon"),b.printed&&"true"!==inASMSession&&(g="success-icon"),d="<span class='fa fa-download iconsPrintDownload xs-pr-10 "+f+"' data-invoiceId='"+b.invoiceId+"'></span>",e="<span class='fa fa-print iconsInvoicePrint "+g+"' data-invoiceId='"+b.invoiceId+"'></span>",d+e}},{field:"location",title:cbp.invoicesPage.globalVars.locationtb,titleTooltip:cbp.invoicesPage.globalVars.locationtb,sortable:!0},{field:"invoiceDate",title:cbp.invoicesPage.globalVars.pickDatetb,titleTooltip:cbp.invoicesPage.globalVars.pickDatetb,"class":"numberIcon text-nowrap",sorter:function(a,b){return a=e(a,cbp.invoicesPage.dateRange.format,!0).format(),b=e(b,cbp.invoicesPage.dateRange.format,!0).format(),a<b?-1:a>b?1:0},sortable:!0,align:"right"},{field:"purchaseOrderNumber",title:cbp.invoicesPage.globalVars.orderNumbertb+"<br> <i>"+cbp.invoicesPage.globalVars.customerPOtb+"</i>",titleTooltip:cbp.invoicesPage.globalVars.orderNumbertb,"class":"numberIcon text-nowrap",sortable:!0,formatter:function(a,b,c){var d,e;return d="ZOOR"==b.salesOrderType&&orderAvailable&&!cbp.invoicesPage.isNARegion?'<a href="javascript:void(0);" onclick="goToOrderDetails(\''+b.orderId+"')\">"+b.orderId+"</a>":b.orderId,e=void 0===b.purchaseOrderNumber||null===b.purchaseOrderNumber?"":"<br> <i>"+b.purchaseOrderNumber+"</i>",d+e}},{field:"invoiceId",title:cbp.invoicesPage.globalVars.invoicetb+(showLegal?"<br> <i>"+cbp.invoicesPage.globalVars.legalInvoicetb+"</i>":""),titleTooltip:cbp.invoicesPage.globalVars.invoicetb,"class":"numberIcon text-nowrap",sortable:!0,formatter:function(a,b,c){var d,e;return d='<a href="javascript:void(0);" onclick="callInvoicePDFLink(\''+b.invoiceId+"')\">"+b.invoiceId+"</a>",e=void 0===b.legalDocumentNumber||null===b.legalDocumentNumber?"":showLegal?"<br> <i>"+b.legalDocumentNumber+"</i>":"",d+e}},{field:"type",title:cbp.invoicesPage.globalVars.docTypetb,titleTooltip:cbp.invoicesPage.globalVars.docTypetb,"class":cbp.invoicesPage.isNARegion?"":"text-nowrap",sortable:!0,formatter:function(a,b,c){return invoiceTypeMapper[a]}},{field:"total",title:cbp.invoicesPage.globalVars.totaltb+(""===cbp.invoicesPage.invoicesResponse.currency?"":" ("+cbp.invoicesPage.invoicesResponse.currency+")")+("true"==ccPaymentEligible?"<br> <i>"+cbp.invoicesPage.globalVars.paymentStatustb+"</i>":""),titleTooltip:cbp.invoicesPage.globalVars.totaltb+" ("+cbp.invoicesPage.invoicesResponse.currency+")","class":"numberIcon text-nowrap",sortable:!0,align:"right",sorter:function(a,b){return null!==a&&null!==b&&(a=parseFloat(a),b=parseFloat(b)),a<b?-1:a>b?1:0},formatter:function(a,b,c){var d,e;return d=a>="0"?b.displayTotal:"<span class='text-danger'>"+b.displayTotal+"</span>",e=void 0===b.cbpInvoiceStatus||null===b.cbpInvoiceStatus||"false"==ccPaymentEligible||"00"===b.cbpInvoiceStatus?"":"<br> <i><span class='text-danger'>"+invoiceStatusMapper[b.cbpInvoiceStatus]+"</span></i>",d+e}},{field:"eftNumber",title:cbp.invoicesPage.globalVars.eftNumber,titleTooltip:cbp.invoicesPage.globalVars.eftNumber,"class":"text-nowrap",sortable:!0,visible:cbp.invoicesPage.showEFT,formatter:function(a,b,c){return'<a href="javascript:void(0);" onclick="goToEftDetails(\''+a+"', '"+b.fiscalYear+"')\">"+a+"</a>"}},{field:"deliveryDate",title:cbp.invoicesPage.globalVars.deliveryDate,titleTooltip:cbp.invoicesPage.globalVars.deliveryDate,"class":"text-nowrap",visible:cbp.invoicesPage.showDeliveryDate,sortable:!0}],d=c.reduce(function(a,b){return a[b.field]=b,a},{});orderKey=["checkbox","status","location","invoiceDate","invoiceId","type","purchaseOrderNumber","total"],console.log("Required order",orderKey);for(var f=[],g=0;g<orderKey.length;g++)for(var h=0;h<b.length;h++)if(orderKey[g]==b[h]){var i=orderKey[g];f.push(d[i])}return f}},D=function(a,d){var e=0;cbp.invoicesPage.invoicesResponse.resultCount>maxResults&&null===cbp.invoicesPage.invoicesResponse.invoicesDataList?(cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatchesMaxResults.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount),a=[]):0===cbp.invoicesPage.invoicesResponse.resultCount?cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatches:cbp.invoicesPage.invoicesResponse.resultCount>maxResults&&"true"!=allInvoiceFlow&&(cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatchesMaxResults.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount),a=[]),null!==a&&void 0!==a||(a=[]),b(c.sortByDdn).val("invoiceDate-desc").selectpicker("refresh"),b("#table").bootstrapTable({classes:"table table-no-bordered",striped:!0,sortName:"invoiceDate",uniqueId:"invoiceId",sortOrder:"desc",iconsPrefix:"fa",sortable:!0,parentContainer:".js-bottom-detail",sortByDropdownId:"#sortByDdn",responsive:!0,responsiveBreakPoint:768,responsiveClass:"bootstrap-table-cardview",onCheck:function(a,b){selectedInvoices.push(a.invoiceId),selectedProduct.push(a.type),selectedInvoiceStatus.push(a.cbpInvoiceStatus),invoiceTotalSum+=a.total,invoiceStatusCodes.indexOf(a.cbpInvoiceStatus)>-1&&(e+=1),e>0&&(enableInvoiceError=!0),enableTotalError=invoiceTotalSum<=0,u()},onCheckAll:function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[];for(var b=a.length,c=0;c<b;c++)selectedInvoices.push(a[c].invoiceId),selectedProduct.push(a[c].type),selectedInvoiceStatus.push(a[c].cbpInvoiceStatus),invoiceTotalSum+=a[c].total,invoiceStatusCodes.indexOf(a[c].cbpInvoiceStatus)>-1&&(e+=1),e>0&&(enableInvoiceError=!0);invoiceTotalSum<=0&&(enableTotalError=!0),a.length&&u()},onUncheck:function(a,d){var f=selectedInvoices.indexOf(a.invoiceId);invoiceTotalSum-=a.total,f>-1&&(selectedInvoices.splice(f,1),selectedProduct.splice(f,1),selectedInvoiceStatus.splice(f,1),w()),b(c.tabelRow).hasClass("selected")||v(),invoiceStatusCodes.indexOf(a.cbpInvoiceStatus)>-1&&(e-=1),e<=0&&(enableInvoiceError=!1,b(".js-selected-invoice-error").addClass("hide")),invoiceTotalSum>=0?(enableTotalError=!1,b(".js-total-amount-error").addClass("hide")):enableTotalError=!0,d.parents("tr").removeClass("bg-danger")},onUncheckAll:function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],e=0,invoiceTotalSum=0,enableInvoiceError=!1,enableTotalError=!1,b(".js-selected-invoice-error").addClass("hide"),b(".js-total-amount-error").addClass("hide"),v(),b("#table tbody").find("tr").removeClass("bg-danger")},columns:C(d),data:a})};return{init:d}}();b(document).ready(function(){b.fn.selectpicker.defaults={noneSelectedText:cbp.invoicesPage.globalVars.selectDdn.noneSelectedText,noneResultsText:cbp.invoicesPage.globalVars.selectDdn.noneResultsText,countSelectedText:function(a,b){return 1==a?cbp.invoicesPage.globalVars.selectDdn.itemSelected:cbp.invoicesPage.globalVars.selectDdn.itemSelected1},maxOptionsText:function(a,b){return[1==a?cbp.invoicesPage.globalVars.selectDdn.limitReached:cbp.invoicesPage.globalVars.selectDdn.limitReached1,1==b?cbp.invoicesPage.globalVars.selectDdn.groupLimit:cbp.invoicesPage.globalVars.selectDdn.groupLimit1]},selectAllText:cbp.invoicesPage.globalVars.selectDdn.selectAllText,deselectAllText:cbp.invoicesPage.globalVars.selectDdn.deselectAllText},b.fn.bootstrapTable.locales={formatLoadingMessage:function(){return cbp.invoicesPage.globalVars.tableLocales.loadingMessage},formatRecordsPerPage:function(a){return cbp.invoicesPage.globalVars.tableLocales.recordsPerPage.replace("{0}",a)},formatShowingRows:function(a,b,c){return cbp.invoicesPage.globalVars.tableLocales.showingRows.replace("{0}",a).replace("{1}",b).replace("{2}",c)},formatSearch:function(){return cbp.invoicesPage.globalVars.tableLocales.search},formatNoMatches:function(){return cbp.invoicesPage.globalVars.tableLocales.noMatches},formatPaginationSwitch:function(){return cbp.invoicesPage.globalVars.tableLocales.paginationSwitch},formatRefresh:function(){return cbp.invoicesPage.globalVars.tableLocales.refresh},formatToggle:function(){return cbp.invoicesPage.globalVars.tableLocales.toggle},formatColumns:function(){return cbp.invoicesPage.globalVars.tableLocales.columns},formatAllRows:function(){return cbp.invoicesPage.globalVars.tableLocales.allRows}},b.extend(b.fn.bootstrapTable.defaults,b.fn.bootstrapTable.locales),"false"==noCardsAdded&&"false"==allCardsExpired&&"true"==ccPaymentEligible&&"true"==showPayInvoice?cbp.invoicesPage.showHideInvoiceBtn="false":cbp.invoicesPage.showHideInvoiceBtn="true",leftPaneExpandCollapse.init(),cbp.invoicesPage.showSoldTo=!0,cbp.invoicesPage.invoicesResponse=invoicesResponse,void 0===invoicesResponse.resultCount||null===invoicesResponse.resultCount?(cbp.invoicesPage.invoicesResponse.resultCount=0,cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",0)):cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",invoicesResponse.resultCount),void 0!==invoicesResponse.invoicesDataList&&null!==invoicesResponse.invoicesDataList||(cbp.invoicesPage.invoicesResponse.invoicesDataList=[]),"true"===allInvoiceFlow||cbp.invoicesPage.invoicesResponse.resultCount>0&&cbp.invoicesPage.invoicesResponse.resultCount<maxResults?cbp.invoicesPage.showDebitCredit=!0:cbp.invoicesPage.showDebitCredit=!1,cbp.invoicesPage.dateRange.startDate=e().subtract(pastSelectableDate,"days"),cbp.invoicesPage.dateRange.endDate=e(),"true"===allInvoiceFlow&&(cbp.invoicesPage.dateRange.startDate=e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month")),cbp.invoicesPage.globalVars.summaryfromAndToVar=cbp.invoicesPage.globalVars.summaryfromAndTo.replace("{0}",cbp.invoicesPage.dateRange.startDate.format(cbp.invoicesPage.dateRange.format)).replace("{1}",cbp.invoicesPage.dateRange.endDate.format(cbp.invoicesPage.dateRange.format)),cbp.invoicesPage.ccPaymentEligible=ccPaymentEligible,cbp.invoicesPage.isNARegion=isNARegion,cbp.invoicesPage.isNARegion?(cbp.invoicesPage.showDeliveryDate=!0,cbp.invoicesPage.showEFT=!0):(cbp.invoicesPage.showDeliveryDate=!1,cbp.invoicesPage.showEFT=!1),t.init()})});for(var locationDropDownOptions=[],startDate,endDate,invoiceObj={},invoiceTotalSum=0,i=0;i<locationDropDown.length;i++){
var obj={};obj.key=locationDropDown[i].soldToNumber,obj.value=locationDropDown[i].soldToAddress,locationDropDownOptions.push(obj)}if(cbp.invoicesPage.locationDropDown.options=locationDropDownOptions,cbp.invoicesPage.locationDropDown.searchable=!0,paymentStatusDropdownOptions.length>1){var obj={};obj.key="all",obj.value=cbp.invoicesPage.paymentStatusDropdown.title,paymentStatusDropdownOptions.unshift(obj)}cbp.invoicesPage.paymentStatusDropdown.options=paymentStatusDropdownOptions;var selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],disablePayError=!1,enableInvoiceError=!1,enableTotalError=!1;require(["modernizr","jquery","bootstrap","handlebars","moment","calendar","bootstrap-select","bootstrap-table","text!app/components/calendar/_calendar.hbs","text!app/components/dropdown/_defaultDdn.hbs","text!app/page/invoices/searchForm.hbs","text!app/page/invoices/invoicesSummary.hbs","text!app/page/invoices/bottomDetail.hbs"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=d.compile(j),o=d.compile(i),p=d.compile(k),q=d.compile(l),r=d.compile(m),s=function(){var a={options:[{key:"invoiceDate-desc",value:cbp.invoicesPage.globalVars.invoiceDateAsc},{key:"invoiceDate-asc",value:cbp.invoicesPage.globalVars.invoiceDateDesc},{key:"location-asc",value:cbp.invoicesPage.globalVars.locationSortAsc},{key:"location-desc",value:cbp.invoicesPage.globalVars.locationSortDesc},{key:"orderId-asc",value:cbp.invoicesPage.globalVars.orderNumberAsc},{key:"orderId-desc",value:cbp.invoicesPage.globalVars.orderNumberDesc},{key:"invoiceId-asc",value:cbp.invoicesPage.globalVars.invoiceNumberAsc},{key:"invoiceId-desc",value:cbp.invoicesPage.globalVars.invoiceNumberDesc},{key:"type-asc",value:cbp.invoicesPage.globalVars.invoiceTypeAsc},{key:"type-desc",value:cbp.invoicesPage.globalVars.invoiceTypeDesc},{key:"total-asc",value:cbp.invoicesPage.globalVars.totalAsc},{key:"total-desc",value:cbp.invoicesPage.globalVars.totalDesc}],label:cbp.invoicesPage.globalVars.sortBy,labelClass:"xs-mr-5",name:"sortByDdn",display:"displayInline"},c={locationDdnContainer:".js-location-ddn",shipToDdnContainer:".js-shipTo-ddn",invoicesSummaryContainer:".js-invoices-summary",invoicesTypeContainer:".js-invoicesType-ddn",paymentStatusContainer:".js-paymentStatus-ddn",downloadStatusContainer:".js-downloadStatus-ddn",printStatusContainer:".js-printStatus-ddn",pickDateRangeContainer:".js-search-pickDateRange",searchFormContainer:".js-search-form",searchDetailContainer:".js-bottom-detail",sortByDdnContainer:".js-sortbyDdn",dropDownCommon:".selectpicker",ordercalendar:"#calendar",searchButton:"#invoicesSearch",tabelRow:"#table tbody tr",downloadBtn:".js-downloadBtn",printBtn:".js-printBtn",payInvBtn:".js-payInvBtn",invoiceTypeDdn:"#invoiceTypeDdn",paymentStatusDdn:"#paymentStatusDdn",locationDdn:"#locationSelectDdn",shipToDdn:"#shipToSelectDdn",downloadStatusDdn:"#downloadStatus",printStatusDdn:"#printStatus",sortByDdn:"#sortByDdn",displaySpinner:".overlay-wrapper",dropdownSelect:".dropdown-menu .toggle-select",invoiceNumber:"#invoiceNumber",orderNumber:"#orderNumber",poNumber:"#poNumber",squareUnchecked:"fa-square-o",squareChecked:"fa-check-square-o",downloadIcon:".iconsPrintDownload",printIcon:".iconsInvoicePrint"},d=function(){if(h(),1==cbp.invoicesPage.locationDropDown.options.length?x(b(c.locationDdn).val(),"all"):cbp.invoicesPage.locationDropDown.options.length>1&&(b(c.shipToDdn).attr("disabled","disabled").selectpicker("refresh"),b(c.searchButton).attr("disabled","disabled")),b(c.locationDdn).selectpicker("refresh"),"true"===allInvoiceFlow&&(b(c.downloadStatusDdn).val("notDownloaded").selectpicker("refresh"),b(c.printStatusDdn).val("notPrinted").selectpicker("refresh")),void 0!==localStorage.getItem("invoiceObj")&&null!==localStorage.getItem("invoiceObj")&&isPaymentFlow){var a=JSON.parse(localStorage.getItem("invoiceObj"));startDate=a.startDate,endDate=a.endDate,cbp.invoicesPage.dateRange.startDate=e(startDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.dateRange.endDate=e(endDate,cbp.invoicesPage.dateRange.format,!0),b(c.invoiceNumber).val(a.invoiceNumber),b(c.orderNumber).val(a.salesOrderNumber),b(c.poNumber).val(a.poNumber),b(c.invoiceTypeDdn).val(a.invoiceTypes).selectpicker("refresh"),b(c.paymentStatusDdn).val(a.paymentStatus).selectpicker("refresh"),b(c.downloadStatusDdn).val(a.downloadStatus).selectpicker("refresh"),b(c.printStatusDdn).val(a.printStatus).selectpicker("refresh"),b(c.locationDdn).val(a.soldTo).selectpicker("refresh"),b.when(x(a.soldTo,a.shipTo)).then(function(a){l()}),localStorage.removeItem("invoiceObj"),b(c.searchButton).removeAttr("disabled")}else z(cbp.invoicesPage.invoicesResponse.invoicesDataList);k(),y(),"true"===noCardsAdded&&"true"===ccPaymentEligible?b(".js-card-error").removeClass("hide"):"true"===allCardsExpired&&"true"===ccPaymentEligible&&b(".js-card-expired-error").removeClass("hide")},f=function(){b("#invoiceForm #selectedInvoices").val(selectedInvoices.toString());for(var a=0;len=selectedInvoices.length,a<len;a++)b(".iconsPrintDownload[data-invoiceid='"+selectedInvoices[a]+"']").addClass("success-icon"),cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+selectedInvoices[a]+"']").data("index")].downloaded=!0;b("#invoiceForm").submit()},g=function(){b("#invoiceForm #selectedInvoices").val(selectedInvoices.toString());var a=b("#contextPath").val()+"/invoices/invoiceListPDF",c=b("#invoiceForm").attr("action");b("#invoiceForm").attr("action",a),b("#invoiceForm").attr("target","_blank");for(var d=0;len=selectedInvoices.length,d<len;d++)b(".iconsInvoicePrint[data-invoiceid='"+selectedInvoices[d]+"']").addClass("success-icon"),cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+selectedInvoices[d]+"']").data("index")].printed=!0;b("#invoiceForm").submit(),b("#invoiceForm").attr("action",c),b("#invoiceForm").removeAttr("target")},h=function(){b(c.searchFormContainer).html(p(cbp.invoicesPage)),b(c.locationDdnContainer).html(n(cbp.invoicesPage.locationDropDown)),b(c.shipToDdnContainer).html(n(cbp.invoicesPage.shipToDropDown)),b(c.downloadStatusContainer).html(n(cbp.invoicesPage.downloadStatusDropdown)),b(c.invoicesTypeContainer).html(n(cbp.invoicesPage.invoiceTypeDropdown)),b(c.paymentStatusContainer).html(n(cbp.invoicesPage.paymentStatusDropdown)),b(c.printStatusContainer).html(n(cbp.invoicesPage.printStatusDropdown)),b(c.pickDateRangeContainer).html(o({label:cbp.invoicesPage.globalVars.pickDateRange,iconClass:cbp.invoicesPage.dateRange.iconClass,id:cbp.invoicesPage.dateRange.id})),i(),b(c.dropDownCommon).selectpicker("refresh"),j(),b(c.displaySpinner).hide()},i=function(){b(c.invoicesSummaryContainer).html(q(cbp.invoicesPage)),b(c.searchDetailContainer).html(r(cbp.invoicesPage)),b(c.sortByDdnContainer).html(n(a)),b(c.sortByDdnContainer).find(c.dropDownCommon).selectpicker("refresh"),j()},j=function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)&&b(c.dropDownCommon).selectpicker("mobile")},k=function(){function a(a,d){startDate=a.format(cbp.invoicesPage.dateRange.format),endDate=d.format(cbp.invoicesPage.dateRange.format),b(c.ordercalendar).find("span").html(cbp.invoicesPage.globalVars.fromAndTo.replace("{0}",startDate).replace("{1}",endDate))}"true"===allInvoiceFlow&&(cbp.invoicesPage.dateRange.startDate=e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month")),a(cbp.invoicesPage.dateRange.startDate,cbp.invoicesPage.dateRange.endDate);var d={};d[cbp.invoicesPage.dateRange.today]=[e(),e()],d[cbp.invoicesPage.dateRange.yesterday]=[e().subtract(1,"days"),e().subtract(1,"days")],d[cbp.invoicesPage.dateRange.last7Days]=[e().subtract(6,"days"),e()],d[cbp.invoicesPage.dateRange.last30Days]=[e().subtract(29,"days"),e()],d[cbp.invoicesPage.dateRange.thisMonth]=[e().startOf("month"),e().endOf("month")],d[cbp.invoicesPage.dateRange.lastMonth]=[e().subtract(1,"month").startOf("month"),e().subtract(1,"month").endOf("month")],b(c.ordercalendar).daterangepicker({startDate:cbp.invoicesPage.dateRange.startDate,endDate:cbp.invoicesPage.dateRange.endDate,ranges:d,minDate:e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month"),maxDate:e(),applyClass:"btn-primary",locale:{format:cbp.invoicesPage.dateRange.format,separator:" - ",applyLabel:cbp.invoicesPage.dateRange.apply,cancelLabel:cbp.invoicesPage.dateRange.cancel,weekLabel:"W",customRangeLabel:cbp.invoicesPage.dateRange.customRange,daysOfWeek:e.weekdaysShort(),monthNames:e.monthsShort(),firstDay:e.localeData().firstDayOfWeek()}},a)},l=function(){function a(a){b(c.displaySpinner).hide(),b(c.searchDetailContainer).show(),b(c.invoicesSummaryContainer).show(),cbp.invoicesPage.invoicesResponse=a,cbp.invoicesPage.invoicesResponse.resultCount>0?cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount):cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",0),cbp.invoicesPage.dateRange.startDate=e(startDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.dateRange.endDate=e(endDate,cbp.invoicesPage.dateRange.format,!0),cbp.invoicesPage.globalVars.summaryfromAndToVar=cbp.invoicesPage.globalVars.summaryfromAndTo.replace("{0}",cbp.invoicesPage.dateRange.startDate.format(cbp.invoicesPage.dateRange.format)).replace("{1}",cbp.invoicesPage.dateRange.endDate.format(cbp.invoicesPage.dateRange.format)),"true"===allInvoiceFlow||cbp.invoicesPage.invoicesResponse.resultCount>0&&cbp.invoicesPage.invoicesResponse.resultCount<maxResults?cbp.invoicesPage.showDebitCredit=!0:cbp.invoicesPage.showDebitCredit=!1,i(),z(cbp.invoicesPage.invoicesResponse.invoicesDataList),leftPaneExpandCollapse.resetSearchFormHeight()}function d(){b(c.displaySpinner).hide(),b(c.searchDetailContainer).show(),b(c.invoicesSummaryContainer).show(),console.log("error")}b(c.displaySpinner).show(),b(c.invoicesSummaryContainer).hide(),b(c.searchDetailContainer).hide(),leftPaneExpandCollapse.hideSearchBar();var f=[];b(c.invoiceTypeDdn).find("option").each(function(){f.push(b(this).val())});var g={};if(g.shipTo=b(c.shipToDdn).val(),g.soldTo=null===b(c.locationDdn).val()?"null":b(c.locationDdn).val().toString(),b(c.invoiceNumber).length>0&&(g.invoiceNumber=b(c.invoiceNumber).val().trim(),b(c.invoiceNumber).val(g.invoiceNumber)),b(c.orderNumber).length>0&&(g.salesOrderNumber=b(c.orderNumber).val().trim(),b(c.orderNumber).val(g.salesOrderNumber)),b(c.poNumber).length>0&&(g.poNumber=b(c.poNumber).val().trim(),b(c.poNumber).val(g.poNumber)),g.invoiceTypes=b(c.invoiceTypeDdn).val()?""+b(c.invoiceTypeDdn).val():f.toString(),g.downloadStatus=b(c.downloadStatusDdn).val(),g.paymentStatus=b(c.paymentStatusDdn).val(),g.printStatus=b(c.printStatusDdn).val(),""!=b(c.invoiceNumber).val()||""!=b(c.orderNumber).val()||""!=b(c.poNumber).val()){var h=e().subtract(cbp.invoicesPage.dateRange.backDatedRange,"month");h=h.format(cbp.invoicesPage.dateRange.format);var j=e();j=j.format(cbp.invoicesPage.dateRange.format),g.fromDate=h,g.toDate=j}else g.fromDate=startDate,g.toDate=endDate;"all"!=b(c.shipToDdn).val()?cbp.invoicesPage.showSoldTo=!1:cbp.invoicesPage.showSoldTo=!0,b.ajax({type:cbp.invoicesPage.globalUrl.method,data:g,url:cbp.invoicesPage.globalUrl.invoicePostURL,success:a,error:d})},m=function(a){"1000"==a?(b(c.orderNumber).siblings("label").text(cbp.invoicesPage.globalVars.altRefNumber),b(c.poNumber).siblings("label").text(cbp.invoicesPage.globalVars.originalDocNumber),cbp.invoicesPage.globalVars.orderNumbertb=cbp.invoicesPage.globalVars.altRefNumbertb,cbp.invoicesPage.globalVars.customerPOtb=cbp.invoicesPage.globalVars.originalDocNumbertb):(b(c.orderNumber).siblings("label").text(cbp.invoicesPage.globalVars.orderNumberNew),b(c.poNumber).siblings("label").text(cbp.invoicesPage.globalVars.poNumberNew),cbp.invoicesPage.globalVars.orderNumbertb=cbp.invoicesPage.globalVars.orderNumbertbNew,cbp.invoicesPage.globalVars.customerPOtb=cbp.invoicesPage.globalVars.customerPOtbNew)},s=function(a){for(var b=0,c=locationDropDown.length;c>b&&locationDropDown[b].soldToNumber!=a;b++);return locationDropDown[b].salesOrg},t=function(a){var c=window.location.pathname,d="<form id='downloadForm' method='POST' action='"+c+"/invoiceCSV'><input type='hidden' name='selectedInvoices' value='"+a+"'/></form>";cbp.invoicesPage.invoicesResponse.invoicesDataList[b("tr[data-uniqueid='"+a+"']").data("index")].downloaded=!0,b(d).appendTo("body").submit().remove()},u=function(){b(c.downloadBtn).removeClass("disabled"),b(c.printBtn).removeClass("disabled"),w()},v=function(){b(c.downloadBtn).addClass("disabled"),b(c.printBtn).addClass("disabled"),w()},w=function(){var a=selectedProduct.length;a>=0&&(disablePayError=!0);for(var d=0;a>d;d++)-1==productCodes.indexOf(selectedProduct[d])&&(disablePayError=!1);a>0?b(c.payInvBtn).removeClass("disabled"):b(c.payInvBtn).addClass("disabled"),(disablePayError||0===a)&&b(".js-selected-product-error").addClass("hide")},x=function(a,d){function e(a){b(c.displaySpinner).hide();var e=[],f={},g=a.marketerLocation;1==g.length?cbp.invoicesPage.shipToDropDown.singleOption=!0:g.length>1&&(f.key="all",f.value=cbp.invoicesPage.globalVars.allLocation,e.push(f));for(var h=0;h<g.length;h++)f={},f.key=g[h].shipToNumber,f.value=g[h].shipToAddress,e.push(f);cbp.invoicesPage.shipToDropDown.options=e,cbp.invoicesPage.shipToDropDown.searchable=!0,b(c.shipToDdnContainer).html(n(cbp.invoicesPage.shipToDropDown)),b(c.shipToDdn).selectpicker("refresh"),cbp.invoicesPage.shipToDropDown.options.length>1&&b(c.shipToDdn).val(d).selectpicker("refresh");for(var i=[],h=0;h<a.invoiceTypeList.length;h++){var j={};j.key=a.invoiceTypeList[h].code,j.value=a.invoiceTypeList[h].description,i.push(j)}cbp.invoicesPage.invoiceTypeDropdown.options=i,b(c.invoicesTypeContainer).html(n(cbp.invoicesPage.invoiceTypeDropdown)),b(c.invoiceTypeDdn).selectpicker("refresh")}function f(){b(c.displaySpinner).hide(),console.log("error")}return b(c.displaySpinner).show(),b.ajax({type:cbp.invoicesPage.globalUrl.method,data:{soldToNumber:a},url:cbp.invoicesPage.globalUrl.shipToURL,success:e,error:f})},y=function(){b(document).on("reset-view.bs.table, toggle.bs.table","#table",function(a){a.stopPropagation();for(var c=0;c<selectedInvoices.length;c++)b("#table tbody tr[data-uniqueid="+selectedInvoices[c]+"]").find("input[type=checkbox]").attr("checked","checked")}),b(document).on("click",c.downloadBtn,function(){f()}),b(document).on("click",c.printBtn,function(){g()}),b(c.locationDdn).on("change",function(a){""!==b(c.locationDdn).val()?b(c.searchButton).removeAttr("disabled"):b(c.searchButton).attr("disabled","disabled");var d=s(b(this).val());m(d),x(b(c.locationDdn).val(),"all")}),b(document).on("change",c.shipToDdn,function(a){}),b(document).on("click",c.downloadIcon,function(a){var c=b("#isInternalUser").val();"true"!=c&&"true"!==inASMSession&&b(a.target).addClass("success-icon"),t(b(a.target).attr("data-invoiceId"))}),b(document).on("click",c.printIcon,function(a){var c=b("#isInternalUser").val();"true"!=c&&"true"!==inASMSession&&b(this).addClass("success-icon"),callInvoicePDF(b(a.target).attr("data-invoiceId"))}),b(c.searchButton).on("click",function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],invoiceObj.shipTo=b("#shipToSelectDdn").val(),invoiceObj.soldTo=b("#locationSelectDdn").val(),invoiceObj.invoiceNumber=b("#invoiceNumber").val(),invoiceObj.salesOrderNumber=b("#orderNumber").val(),invoiceObj.poNumber=b("#poNumber").val(),invoiceObj.invoiceTypes=b("#invoiceTypeDdn").val(),invoiceObj.downloadStatus=b("#downloadStatus").val(),invoiceObj.printStatus=b("#printStatus").val(),invoiceObj.paymentStatus=b("#paymentStatusDdn").val(),invoiceObj.startDate=startDate,invoiceObj.endDate=endDate,b(".alert-danger").addClass("hide"),l()});var a=".js-search-form input,"+c.printStatusContainer+","+c.locationDdnContainer+","+c.downloadStatusContainer+","+c.pickDateRangeContainer;b(document).on("keypress",a,function(a){13==a.which&&(a.preventDefault(),b("#invoicesSearch").trigger("click"))});var d=c.invoiceNumber+","+c.orderNumber;b(document).on("keypress",d,function(a){var b=/^[0-9]+$/,c=String.fromCharCode(a.which);return!!c.match(b)||(a.preventDefault(),!1)})},z=function(a){var d=0;cbp.invoicesPage.invoicesResponse.resultCount>maxResults&&null===cbp.invoicesPage.invoicesResponse.invoicesDataList?(cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatchesMaxResults.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount),a=[]):0===cbp.invoicesPage.invoicesResponse.resultCount?cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatches:cbp.invoicesPage.invoicesResponse.resultCount>maxResults&&"true"!=allInvoiceFlow&&(cbp.invoicesPage.globalVars.tableLocales.noMatches=cbp.invoicesPage.globalVars.noMatchesMaxResults.replace("{0}",cbp.invoicesPage.invoicesResponse.resultCount),a=[]),(null===a||void 0===a)&&(a=[]),b(c.sortByDdn).val("invoiceDate-desc").selectpicker("refresh"),b("#table").bootstrapTable({classes:"table table-no-bordered",striped:!0,sortName:"invoiceDate",uniqueId:"invoiceId",sortOrder:"desc",iconsPrefix:"fa",sortable:!0,parentContainer:".js-bottom-detail",sortByDropdownId:"#sortByDdn",responsive:!0,responsiveBreakPoint:768,responsiveClass:"bootstrap-table-cardview",onCheck:function(a,b){selectedInvoices.push(a.invoiceId),selectedProduct.push(a.type),selectedInvoiceStatus.push(a.cbpInvoiceStatus),invoiceTotalSum+=a.total,invoiceStatusCodes.indexOf(a.cbpInvoiceStatus)>-1&&(d+=1),d>0&&(enableInvoiceError=!0),enableTotalError=0>=invoiceTotalSum,u()},onCheckAll:function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[];for(var b=a.length,c=0;b>c;c++)selectedInvoices.push(a[c].invoiceId),selectedProduct.push(a[c].type),selectedInvoiceStatus.push(a[c].cbpInvoiceStatus),invoiceTotalSum+=a[c].total,invoiceStatusCodes.indexOf(a[c].cbpInvoiceStatus)>-1&&(d+=1),d>0&&(enableInvoiceError=!0);0>=invoiceTotalSum&&(enableTotalError=!0),a.length&&u()},onUncheck:function(a,e){var f=selectedInvoices.indexOf(a.invoiceId);invoiceTotalSum-=a.total,f>-1&&(selectedInvoices.splice(f,1),selectedProduct.splice(f,1),selectedInvoiceStatus.splice(f,1),w()),b(c.tabelRow).hasClass("selected")||v(),invoiceStatusCodes.indexOf(a.cbpInvoiceStatus)>-1&&(d-=1),0>=d&&(enableInvoiceError=!1,b(".js-selected-invoice-error").addClass("hide")),invoiceTotalSum>=0?(enableTotalError=!1,b(".js-total-amount-error").addClass("hide")):enableTotalError=!0,e.parents("tr").removeClass("bg-danger")},onUncheckAll:function(a){selectedInvoices=[],selectedProduct=[],selectedInvoiceStatus=[],d=0,invoiceTotalSum=0,enableInvoiceError=!1,enableTotalError=!1,b(".js-selected-invoice-error").addClass("hide"),b(".js-total-amount-error").addClass("hide"),v(),b("#table tbody").find("tr").removeClass("bg-danger")},columns:[{field:"",checkbox:!0,"class":"fa",formatter:function(a,b,c){return'<input type="hidden" name="type" value="'+b.type+"@"+b.cbpInvoiceStatus+'">'}},{field:"status",title:cbp.invoicesPage.globalVars.statustb,titleTooltip:cbp.invoicesPage.globalVars.statustb,"class":"text-nowrap",formatter:function(a,b,c){var d,e,f="",g="";return b.downloaded&&"true"!==inASMSession&&(f="success-icon"),b.printed&&"true"!==inASMSession&&(g="success-icon"),d="<span class='fa fa-download iconsPrintDownload xs-pr-10 "+f+"' data-invoiceId='"+b.invoiceId+"'></span>",e="<span class='fa fa-print iconsInvoicePrint "+g+"' data-invoiceId='"+b.invoiceId+"'></span>",d+e}},{field:"location",title:cbp.invoicesPage.globalVars.locationtb,titleTooltip:cbp.invoicesPage.globalVars.locationtb,sortable:!0},{field:"invoiceDate",title:cbp.invoicesPage.globalVars.pickDatetb,titleTooltip:cbp.invoicesPage.globalVars.pickDatetb,"class":"numberIcon text-nowrap",sorter:function(a,b){return a=e(a,cbp.invoicesPage.dateRange.format,!0).format(),b=e(b,cbp.invoicesPage.dateRange.format,!0).format(),b>a?-1:a>b?1:0},sortable:!0,align:"right"},{field:"orderId",title:cbp.invoicesPage.globalVars.orderNumbertb+"<br> <i>"+cbp.invoicesPage.globalVars.customerPOtb+"</i>",titleTooltip:cbp.invoicesPage.globalVars.orderNumbertb,"class":"numberIcon text-nowrap",sortable:!0,formatter:function(a,b,c){var d,e;return d="ZOOR"==b.salesOrderType&&orderAvailable&&!cbp.invoicesPage.isNARegion?'<a href="javascript:void(0);" onclick="goToOrderDetails(\''+b.orderId+"')\">"+b.orderId+"</a>":b.orderId,e=void 0===b.purchaseOrderNumber||null===b.purchaseOrderNumber?"":"<br> <i>"+b.purchaseOrderNumber+"</i>",d+e}},{field:"invoiceId",title:cbp.invoicesPage.globalVars.invoicetb+(showLegal?"<br> <i>"+cbp.invoicesPage.globalVars.legalInvoicetb+"</i>":""),titleTooltip:cbp.invoicesPage.globalVars.invoicetb,"class":"numberIcon text-nowrap",sortable:!0,formatter:function(a,b,c){var d,e;return d='<a href="javascript:void(0);" onclick="callInvoicePDFLink(\''+b.invoiceId+"')\">"+b.invoiceId+"</a>",e=void 0===b.legalDocumentNumber||null===b.legalDocumentNumber?"":showLegal?"<br> <i>"+b.legalDocumentNumber+"</i>":"",d+e}},{field:"type",title:cbp.invoicesPage.globalVars.docTypetb,titleTooltip:cbp.invoicesPage.globalVars.docTypetb,"class":cbp.invoicesPage.isNARegion?"":"text-nowrap",sortable:!0,formatter:function(a,b,c){return invoiceTypeMapper[a]}},{field:"total",title:cbp.invoicesPage.globalVars.totaltb+(""===cbp.invoicesPage.invoicesResponse.currency?"":" ("+cbp.invoicesPage.invoicesResponse.currency+")")+("true"==ccPaymentEligible?"<br> <i>"+cbp.invoicesPage.globalVars.paymentStatustb+"</i>":""),titleTooltip:cbp.invoicesPage.globalVars.totaltb+" ("+cbp.invoicesPage.invoicesResponse.currency+")","class":"numberIcon text-nowrap",sortable:!0,align:"right",sorter:function(a,b){return null!==a&&null!==b&&(a=parseFloat(a),b=parseFloat(b)),b>a?-1:a>b?1:0},formatter:function(a,b,c){var d,e;return d=a>="0"?b.displayTotal:"<span class='text-danger'>"+b.displayTotal+"</span>",e=void 0===b.cbpInvoiceStatus||null===b.cbpInvoiceStatus||"false"==ccPaymentEligible||"00"===b.cbpInvoiceStatus?"":"<br> <i><span class='text-danger'>"+invoiceStatusMapper[b.cbpInvoiceStatus]+"</span></i>",d+e}},{field:"eftNumber",title:cbp.invoicesPage.globalVars.eftNumber,titleTooltip:cbp.invoicesPage.globalVars.eftNumber,"class":"text-nowrap",sortable:!0,visible:cbp.invoicesPage.showEFT,formatter:function(a,b,c){return'<a href="javascript:void(0);" onclick="goToEftDetails(\''+a+"', '"+b.fiscalYear+"')\">"+a+"</a>"}},{field:"deliveryDate",title:cbp.invoicesPage.globalVars.deliveryDate,titleTooltip:cbp.invoicesPage.globalVars.deliveryDate,"class":"text-nowrap",visible:cbp.invoicesPage.showDeliveryDate,sortable:!0}],data:a})};return{init:d}}();b(document).ready(function(){b.fn.selectpicker.defaults={noneSelectedText:cbp.invoicesPage.globalVars.selectDdn.noneSelectedText,noneResultsText:cbp.invoicesPage.globalVars.selectDdn.noneResultsText,countSelectedText:function(a,b){return 1==a?cbp.invoicesPage.globalVars.selectDdn.itemSelected:cbp.invoicesPage.globalVars.selectDdn.itemSelected1},maxOptionsText:function(a,b){return[1==a?cbp.invoicesPage.globalVars.selectDdn.limitReached:cbp.invoicesPage.globalVars.selectDdn.limitReached1,1==b?cbp.invoicesPage.globalVars.selectDdn.groupLimit:cbp.invoicesPage.globalVars.selectDdn.groupLimit1]},selectAllText:cbp.invoicesPage.globalVars.selectDdn.selectAllText,deselectAllText:cbp.invoicesPage.globalVars.selectDdn.deselectAllText},b.fn.bootstrapTable.locales={formatLoadingMessage:function(){return cbp.invoicesPage.globalVars.tableLocales.loadingMessage},formatRecordsPerPage:function(a){return cbp.invoicesPage.globalVars.tableLocales.recordsPerPage.replace("{0}",a)},formatShowingRows:function(a,b,c){return cbp.invoicesPage.globalVars.tableLocales.showingRows.replace("{0}",a).replace("{1}",b).replace("{2}",c)},formatSearch:function(){return cbp.invoicesPage.globalVars.tableLocales.search},formatNoMatches:function(){return cbp.invoicesPage.globalVars.tableLocales.noMatches},formatPaginationSwitch:function(){return cbp.invoicesPage.globalVars.tableLocales.paginationSwitch},formatRefresh:function(){return cbp.invoicesPage.globalVars.tableLocales.refresh},formatToggle:function(){return cbp.invoicesPage.globalVars.tableLocales.toggle},formatColumns:function(){return cbp.invoicesPage.globalVars.tableLocales.columns},formatAllRows:function(){return cbp.invoicesPage.globalVars.tableLocales.allRows}},b.extend(b.fn.bootstrapTable.defaults,b.fn.bootstrapTable.locales),"false"==noCardsAdded&&"false"==allCardsExpired&&"true"==ccPaymentEligible&&"true"==showPayInvoice?cbp.invoicesPage.showHideInvoiceBtn="false":cbp.invoicesPage.showHideInvoiceBtn="true",leftPaneExpandCollapse.init(),cbp.invoicesPage.showSoldTo=!0,cbp.invoicesPage.invoicesResponse=invoicesResponse,void 0===invoicesResponse.resultCount||null===invoicesResponse.resultCount?(cbp.invoicesPage.invoicesResponse.resultCount=0,cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",0)):cbp.invoicesPage.globalVars.invoicesFoundVar=cbp.invoicesPage.globalVars.invoicesFound.replace("{0}",invoicesResponse.resultCount),(void 0===invoicesResponse.invoicesDataList||null===invoicesResponse.invoicesDataList)&&(cbp.invoicesPage.invoicesResponse.invoicesDataList=[]),"true"===allInvoiceFlow||cbp.invoicesPage.invoicesResponse.resultCount>0&&cbp.invoicesPage.invoicesResponse.resultCount<maxResults?cbp.invoicesPage.showDebitCredit=!0:cbp.invoicesPage.showDebitCredit=!1,cbp.invoicesPage.dateRange.startDate=e().subtract(pastSelectableDate,"days"),cbp.invoicesPage.dateRange.endDate=e(),"true"===allInvoiceFlow&&(cbp.invoicesPage.dateRange.startDate=e().subtract(cbp.invoicesPage.dateRange.maxMonth,"month")),cbp.invoicesPage.globalVars.summaryfromAndToVar=cbp.invoicesPage.globalVars.summaryfromAndTo.replace("{0}",cbp.invoicesPage.dateRange.startDate.format(cbp.invoicesPage.dateRange.format)).replace("{1}",cbp.invoicesPage.dateRange.endDate.format(cbp.invoicesPage.dateRange.format)),cbp.invoicesPage.ccPaymentEligible=ccPaymentEligible,cbp.invoicesPage.isNARegion=isNARegion,cbp.invoicesPage.isNARegion?(cbp.invoicesPage.showDeliveryDate=!0,cbp.invoicesPage.showEFT=!0):(cbp.invoicesPage.showDeliveryDate=!1,cbp.invoicesPage.showEFT=!1),s.init()})});